(function(){$(document).ready(function(){var e,n,t,o,a,r,l,i,s,c,u,g,d;return $.support.localStorage?($(window.applicationCache).bind("error",function(){return console.log("There was an error when loading the cache manifest.")}),i="/links",l="/links.json",g="/status.json",n="/clear_all",t=$("#content"),d=$("#url-box"),r=$("#link_template"),s=function(e){var n,t;return n=/^((http[s]?|ftp):\/)?\/?([^:\/\s]+(\.\w{2,4}))(\/|)(...){0,20}$/i,t=e.match(n),t[3].replace(/www\./g,"").toLowerCase()},u=function(){var e,n;return localStorage.getItem("isOnline")&&(n=$.parseJSON(localStorage.pendingLinks),n.length>0)?(e=n[0],$.post(i,e.data,function(e){return n=$.parseJSON(localStorage.pendingLinks),n.shift(),localStorage.pendingLinks=JSON.stringify(n),setTimeout(u,100)})):void 0},e=function(){return localStorage.getItem("isOnline")?(window.localStorage.setItem("toDelete",!1),$.ajax({type:"DELETE",dataType:"json",url:n,data:{_method:"delete"},success:function(e){return alert("All links deleted!")}})):void 0},o=function(){return window.localStorage.setItem("isOnline",!1),console.log("Connection was lost. Now you in Offline version. Try reconnect.")},c=function(){return $.ajax({url:g,type:"GET",dataType:"json",success:function(n,t,o){return 0===this.xhr().status,200===o.status&&(window.localStorage.setItem("isOnline",!0),a(),localStorage.pendingLinks.length>0&&u(),localStorage.getItem("toDelete")===!0)?e():void 0},error:o})},a=function(){return localStorage.pendingLinks||(localStorage.pendingLinks=JSON.stringify([])),$.retrieveJSON(l,function(e,n,o){var a;return a=$.parseJSON(localStorage.pendingLinks),t.html($("#link_template").tmpl(a.reverse().concat(e)))},{contentType:"application/json;charset=utf-8",mimeType:"application/json",dataType:"json"})},$("#clear_all").click(function(e){return $.each(localStorage,function(e,n){return window.localStorage.removeItem(e)}),t.empty(),localStorage.getItem("isOnline")===!1&&window.localStorage.setItem("toDelete",!0),localStorage.pendingLinks||(localStorage.pendingLinks=JSON.stringify([])),$.ajax({type:"DELETE",dataType:"json",url:n,data:{_method:"delete"},success:function(e){return alert("All links deleted!")}})}),$("form").submit(function(e){var n,t;return e.preventDefault(),t=$.parseJSON(localStorage.pendingLinks),n={data:$(this).serialize(),link:{url:s(d.val())}},$("dt:contains("+n.link.url+")").remove(),r.tmpl(n).prependTo("#content"),t.push(n),localStorage.pendingLinks=JSON.stringify(t),u(),d.val(""),!1}),a(),setInterval(function(){return c()},15e3),u(),$(window).bind("online",u)):alert("Try a different browser.")})}).call(this);