(function(){$(document).ready(function(){var e,n,t,o,r;return $.support.localStorage?(t=function(e){var n,t;return n=/^((http[s]?|ftp):\/)?\/?([^:\/\s]+(\.\w{2,4}))(\/|)(...){0,20}$/i,t=e.match(n),t[3].replace(/www\./g,"").toLowerCase()},r=function(){var e,n;return window.navigator.onLine&&(n=$.parseJSON(localStorage.pendingLinks),n.length>0)?(e=n[0],$.post("/links",e.data,function(e){return n=$.parseJSON(localStorage.pendingLinks),n.shift(),localStorage.pendingLinks=JSON.stringify(n),setTimeout(r,100)})):void 0},e=function(){return window.navigator.onLine&&localStorage.key("toDelete")?(localStorage.removeItem("toDelete"),$.post("/links/clear_all",{_method:"delete"},{dataType:"json"},function(e){return e.preventDefault()})):void 0},$(window.applicationCache).bind("error",function(){return console.log("There was an error when loading the cache manifest.")}),localStorage.pendingLinks||(localStorage.pendingLinks=JSON.stringify([])),$.retrieveJSON("/links.json",function(e){var n;return n=$.parseJSON(localStorage.pendingLinks),$("#content").html($("#link_template").tmpl(n.reverse().concat(e)))}),$("#clear_all").click(function(e){return e.preventDefault(),localStorage.clear(),$("#content").empty(),window.navigator.onLine||localStorage.setItem("toDelete",!0),$.post("/links/clear_all",{_method:"delete"},{dataType:"json"},function(e){return alert("All links deleted!")})}),$("#new_link").submit(function(e){var n,o,a;return e.preventDefault(),o=$.parseJSON(localStorage.pendingLinks),a=t($("#url-box").val()),n={data:$(this).serialize(),link:{url:a}},$("dt:contains("+n.link.url+")").remove(),$("#link_template").tmpl(n).prependTo("#content"),o.push(n),localStorage.pendingLinks=JSON.stringify(o),r(),$("#url-box").val("")}),n=function(){return console.log("Connection was lost. Now you in Offline version. Try to connect.")},setInterval(function(){return o()},15e3),o=function(){return $.ajax({url:"/status.json",type:"GET",dataType:"json",success:function(e,n,t){return 0===this.xhr().status,200===t.status?(console.log("200 ok"),r()):void 0},error:n})},r(),$(window).bind("online",r)):alert("Try a different browser.")})}).call(this);